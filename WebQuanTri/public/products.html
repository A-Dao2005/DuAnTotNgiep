<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Qu·∫£n l√Ω s·∫£n ph·∫©m</title>
  <style>
    body {
      font-family: Arial, sans-serif; background: #f4f6fb; margin: 0;
    }
    .sidebar {
      width: 220px; height: 100vh; position: fixed; left: 0; top: 0;
      background: #1a2235; color: #fff; display: flex; flex-direction: column; padding-top: 20px;
      box-shadow: 2px 0 8px rgba(0,0,0,0.1);
    }
    .sidebar h3 {
      text-align: center; margin-bottom: 20px; font-size: 20px; color: #FFD700;
    }
    .sidebar a {
      color: #fff; padding: 12px 20px; text-decoration: none; display: block;
      transition: background 0.3s; font-size: 16px;
    }
    .sidebar a:hover, .sidebar a.active {
      background: #1976D2;
    }
    .main {
      margin-left: 220px; padding: 30px;
    }
    h2 {
      color: #1976D2; font-size: 24px; margin-bottom: 20px;
    }
    button {
      background: #1976D2; color: white; border: none; padding: 8px 16px; border-radius: 4px;
      cursor: pointer; margin-bottom: 20px; font-size: 14px;
    }
    button:hover { background: #0f5cb5; }
    table {
      width: 100%; border-collapse: collapse; background: #fff;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05); border-radius: 8px; overflow: hidden;
    }
    th, td {
      padding: 12px; border-bottom: 1px solid #eee; text-align: center;
    }
    th {
      background: #1976D2; color: #fff;
    }
    tr:hover { background: #f0f8ff; }
    img {
      width: 60px; height: 60px; object-fit: cover;
    }
    #modal, #modal-delete {
      display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background-color: rgba(0, 0, 0, 0.5); justify-content: center; align-items: center;
    }
    .modal-content {
      background: #fff; padding: 20px; border-radius: 8px; width: 350px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }
    .modal-content input {
      width: 100%; padding: 10px; margin-bottom: 12px; border: 1px solid #ccc; border-radius: 4px;
    }
    .modal-content button {
      margin-right: 10px;
    }
  </style>
</head>
<body>
<div class="sidebar">
  <h3>DomiMart Admin</h3>
  <a href="products.html" class="active">üì¶ Qu·∫£n l√Ω s·∫£n ph·∫©m</a>
  <a href="orders.html">üìã ƒê∆°n h√†ng</a>
  <a href="users.html">üë§ Kh√°ch h√†ng</a>
  <a href="chat.html">üí¨ Chat kh√°ch h√†ng</a>
  <a href="statistics.html">üìä Th·ªëng k√™</a>
  <a href="history.html">üìÅ L·ªãch s·ª≠ ƒë∆°n h√†ng</a>
  <a href="settings.html">‚öôÔ∏è C√†i ƒë·∫∑t t√†i kho·∫£n</a>
  <a href="feedback.html">üó®Ô∏è Ph·∫£n h·ªìi</a>
</div>

<div class="main">
  <h2>üì¶ Qu·∫£n l√Ω s·∫£n ph·∫©m</h2>
  <button onclick="openModal()">+ Th√™m s·∫£n ph·∫©m</button>
  <table>
    <thead>
      <tr><th>·∫¢nh</th><th>M√£ SP</th><th>T√™n</th><th>Gi√°</th><th>Ph√¢n lo·∫°i</th><th>H√†nh ƒë·ªông</th></tr>
    </thead>
    <tbody id="product-body"></tbody>
  </table>
</div>

<div id="modal">
  <div class="modal-content">
    <h3 id="modal-title">Th√™m s·∫£n ph·∫©m</h3>
    <input id="image" placeholder="Link ·∫£nh">
    <input id="maSP" placeholder="M√£ SP">
    <input id="tenSanPham" placeholder="T√™n s·∫£n ph·∫©m">
    <input id="giaSanPham" placeholder="Gi√°">
    <input id="phanLoai" placeholder="Ph√¢n lo·∫°i">
    <button onclick="saveProduct()">L∆∞u</button>
    <button onclick="closeModal()">H·ªßy</button>
  </div>
</div>

<div id="modal-delete">
  <div class="modal-content">
    <h3>B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën xo√° s·∫£n ph·∫©m n√†y?</h3>
    <button onclick="confirmDelete()">Xo√°</button>
    <button onclick="closeDeleteModal()">H·ªßy</button>
  </div>
</div>

<script>
  const API_URL = 'http://localhost:5000/api/products';
  let editId = null, deleteId = null;
  function openModal(product = null) {
    document.getElementById('modal').style.display = 'flex';
    document.getElementById('modal-title').innerText = product ? 'S·ª≠a s·∫£n ph·∫©m' : 'Th√™m s·∫£n ph·∫©m';
    editId = product?._id || null;
    document.getElementById('image').value = product?.image || '';
    document.getElementById('maSP').value = product?.maSP || '';
    document.getElementById('tenSanPham').value = product?.tenSanPham || '';
    document.getElementById('giaSanPham').value = product?.giaSanPham || '';
    document.getElementById('phanLoai').value = product?.phanLoai || '';
  }
  function closeModal() {
    document.getElementById('modal').style.display = 'none'; editId = null;
  }
  function openDeleteModal(id) {
    deleteId = id;
    document.getElementById('modal-delete').style.display = 'flex';
  }
  function closeDeleteModal() {
    deleteId = null;
    document.getElementById('modal-delete').style.display = 'none';
  }
  async function confirmDelete() {
    await fetch(`${API_URL}/${deleteId}`, { method: 'DELETE' });
    alert('Xo√° th√†nh c√¥ng'); closeDeleteModal(); fetchProducts();
  }
  async function fetchProducts() {
    const res = await fetch(API_URL);
    const data = await res.json();
    const tbody = document.getElementById('product-body');
    tbody.innerHTML = '';
    data.forEach(p => {
      tbody.innerHTML += `
        <tr>
          <td><img src="${p.image}" alt="·∫¢nh"></td>
          <td>${p.maSP}</td>
          <td>${p.tenSanPham}</td>
          <td>${p.giaSanPham}‚Ç´</td>
          <td>${p.phanLoai}</td>
          <td>
            <button onclick='openModal(${JSON.stringify(p)})'>S·ª≠a</button>
            <button onclick="openDeleteModal('${p._id}')">Xo√°</button>
          </td>
        </tr>
      `;
    });
  }
  async function saveProduct() {
    const image = document.getElementById('image').value;
    const maSP = document.getElementById('maSP').value;
    const tenSanPham = document.getElementById('tenSanPham').value;
    const giaSanPham = document.getElementById('giaSanPham').value;
    const phanLoai = document.getElementById('phanLoai').value;
    const method = editId ? 'PUT' : 'POST';
    const url = editId ? `${API_URL}/${editId}` : API_URL;
    await fetch(url, {
      method, headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ image, maSP, tenSanPham, giaSanPham, phanLoai })
    });
    alert(editId ? 'C·∫≠p nh·∫≠t th√†nh c√¥ng!' : 'Th√™m th√†nh c√¥ng!');
    closeModal(); fetchProducts();
  }
  fetchProducts();
</script>
</body>
</html>
