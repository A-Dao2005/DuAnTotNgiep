<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Qu·∫£n l√Ω s·∫£n ph·∫©m</title>
  <link rel="stylesheet" href="products.css">
  <style>
    #modal, #modal-delete {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal-content {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      width: 400px;
    }
    .modal-content input {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    .modal-content button {
      margin-right: 10px;
    }
  </style>
</head>
<body>
<div class="sidebar">
  <h3>Admin Panel</h3>
  <a href="products.html" class="active">üì¶ Qu·∫£n l√Ω s·∫£n ph·∫©m</a>
  <a href="orders.html">üìã ƒê∆°n h√†ng</a>
  <a href="chat.html">üí¨ Chat kh√°ch h√†ng</a>
  <a href="statistics.html">üìä Th·ªëng k√™</a>
  <a href="history.html">üìÅ L·ªãch s·ª≠ ƒë∆°n h√†ng</a>
  <a href="settings.html">‚öôÔ∏è C√†i ƒë·∫∑t t√†i kho·∫£n</a>
</div>

<h2>üì¶ Qu·∫£n l√Ω s·∫£n ph·∫©m</h2>
<button onclick="openModal()">+ Th√™m s·∫£n ph·∫©m</button>

<table>
  <thead>
    <tr>
      <th>·∫¢nh</th>
      <th>M√£ SP</th>
      <th>T√™n</th>
      <th>Gi√°</th>
      <th>Ph√¢n lo·∫°i</th>
      <th>H√†nh ƒë·ªông</th>
    </tr>
  </thead>
  <tbody id="product-body"></tbody>
</table>

<div id="modal">
  <div class="modal-content">
    <h3 id="modal-title">Th√™m s·∫£n ph·∫©m</h3>
    <input id="image" placeholder="Link ·∫£nh">
    <input id="maSP" placeholder="M√£ SP">
    <input id="tenSanPham" placeholder="T√™n s·∫£n ph·∫©m">
    <input id="giaSanPham" placeholder="Gi√°">
    <input id="phanLoai" placeholder="Ph√¢n lo·∫°i">
    <button onclick="saveProduct()">L∆∞u</button>
    <button onclick="closeModal()">H·ªßy</button>
  </div>
</div>

<div id="modal-delete">
  <div class="modal-content">
    <h3>B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën xo√° s·∫£n ph·∫©m n√†y?</h3>
    <button onclick="confirmDelete()">Xo√°</button>
    <button onclick="closeDeleteModal()">H·ªßy</button>
  </div>
</div>

<script>
  const API_URL = 'http://localhost:5000/api/products';
  let editId = null;
  let deleteId = null;

  function openModal(product = null) {
    document.getElementById('modal').style.display = 'flex';
    document.getElementById('modal-title').innerText = product ? 'S·ª≠a s·∫£n ph·∫©m' : 'Th√™m s·∫£n ph·∫©m';
    editId = product?._id || null;

    document.getElementById('image').value = product?.image || '';
    document.getElementById('maSP').value = product?.maSP || '';
    document.getElementById('tenSanPham').value = product?.tenSanPham || '';
    document.getElementById('giaSanPham').value = product?.giaSanPham || '';
    document.getElementById('phanLoai').value = product?.phanLoai || '';
  }

  function closeModal() {
    document.getElementById('modal').style.display = 'none';
    editId = null;
  }

  function openDeleteModal(id) {
    deleteId = id;
    document.getElementById('modal-delete').style.display = 'flex';
  }

  function closeDeleteModal() {
    deleteId = null;
    document.getElementById('modal-delete').style.display = 'none';
  }

  async function confirmDelete() {
    await fetch(`${API_URL}/${deleteId}`, { method: 'DELETE' });
    alert('Xo√° th√†nh c√¥ng');
    closeDeleteModal();
    fetchProducts();
  }

  async function fetchProducts() {
    const res = await fetch(API_URL);
    const data = await res.json();
    const tbody = document.getElementById('product-body');
    tbody.innerHTML = '';

    data.forEach(p => {
      tbody.innerHTML += `
        <tr data-id="${p._id}">
          <td><img src="${p.image}" alt="·∫¢nh"></td>
          <td>${p.maSP}</td>
          <td>${p.tenSanPham}</td>
          <td>${p.giaSanPham}‚Ç´</td>
          <td>${p.phanLoai}</td>
          <td>
            <button onclick='editProduct(${JSON.stringify(p)})'>S·ª≠a</button>
            <button onclick="openDeleteModal('${p._id}')">Xo√°</button>
          </td>
        </tr>
      `;
    });
  }

  function editProduct(product) {
    openModal(product);
  }

  async function saveProduct() {
    const image = document.getElementById('image').value;
    const maSP = document.getElementById('maSP').value;
    const tenSanPham = document.getElementById('tenSanPham').value;
    const giaSanPham = document.getElementById('giaSanPham').value;
    const phanLoai = document.getElementById('phanLoai').value;

    const method = editId ? 'PUT' : 'POST';
    const url = editId ? `${API_URL}/${editId}` : API_URL;

    await fetch(url, {
      method,
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ image, maSP, tenSanPham, giaSanPham, phanLoai })
    });

    alert(editId ? 'C·∫≠p nh·∫≠t th√†nh c√¥ng!' : 'Th√™m th√†nh c√¥ng!');
    closeModal();
    fetchProducts();
  }

  fetchProducts();
</script>
</body>
</html>